:root{
  --bg:#0f1115; --panel:#151a22; --card:#1b2230; --text:#e8eefc; --muted:#a9b4cd;
  --border:rgba(255,255,255,.10); --accent:#7aa2ff; --warn:#ffcc66;
}
html[data-theme="light"]{
  --bg:#ffffff; --panel:#f5f7fb; --card:#ffffff; --text:#0b1220; --muted:#4b5563;
  --border:rgba(0,0,0,.10); --accent:#2f6bff; --warn:#b45309;
}
html,body{height:100%; margin:0; background:var(--bg); color:var(--text);
  font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"PingFang SC","Microsoft Yahei",Arial;}
.app{display:grid; grid-template-columns: 380px 1fr; height:100%; grid-template-rows: 100%;}
.panel{background:var(--panel); border-right:1px solid var(--border); padding:14px 14px 10px; overflow:auto; position:relative; z-index:2;}
.title{font-weight:700; font-size:16px; letter-spacing:.3px;}
.subtitle{margin-top:6px; color:var(--muted); font-size:12px; line-height:1.5;}
.section{margin-top:14px; padding-top:12px; border-top:1px solid var(--border);}
.section h3{margin:0 0 10px; font-size:13px;}
.row{display:flex; gap:10px; align-items:center; margin:8px 0;}
.row label{flex: 0 0 120px; font-size:12px; color:var(--muted);}
select,input[type="number"],input[type="text"]{
  width:100%; padding:8px 10px; background:var(--card); color:var(--text); border:1px solid var(--border);
  border-radius:10px; outline:none;
}
.toggles{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:6px;}
.toggle{display:flex; gap:8px; align-items:center; background:var(--card); border:1px solid var(--border);
  padding:8px 10px; border-radius:10px; user-select:none;}
.toggle span{font-size:12px; color:var(--muted);}
.toggle input{transform: translateY(0.5px);}

button{
  background:var(--card); color:var(--text); border:1px solid var(--border); border-radius:12px;
  padding:8px 10px; cursor:pointer; font-size:12px;
}
button:hover{border-color: color-mix(in srgb, var(--accent) 35%, var(--border));}
button.primary{border-color: color-mix(in srgb, var(--accent) 65%, var(--border)); background: color-mix(in srgb, var(--accent) 14%, var(--card));}
button.pill{border-radius:999px; padding:8px 12px;}
button.icon{
  width:26px; height:26px; padding:0; border-radius:8px;
  display:inline-flex; align-items:center; justify-content:center; font-size:13px;
}
button.icon[aria-expanded="true"]{border-color: color-mix(in srgb, var(--accent) 35%, var(--border));}

.btnbar{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:10px;}
.btnbar button{flex:1; min-width:0;}
.pending{display:none; margin-top:8px; font-size:12px; color:var(--warn); line-height:1.4;}
.pending.show{display:block;}

.kpi{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;}
.kpi .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:10px;}
.kpi .v{font-weight:700; font-size:14px;}
.kpi .k{font-size:11px; color:var(--muted); margin-top:4px;}
.note{margin-top:8px; font-size:12px; color:var(--muted); line-height:1.5;}

/* ---- Coupling progress ---- */
.cpl-progress{ margin-top:10px; padding:10px; border:1px solid var(--border); border-radius:12px; background: rgba(255,255,255,0.03); }
.cpl-progress-row{ display:flex; align-items:center; gap:10px; }
.cpl-progress-bar{ position:relative; flex:1; height:10px; border-radius:999px; overflow:hidden; background: rgba(255,255,255,0.06); border:1px solid var(--border); }
.cpl-progress-fill{ position:absolute; left:0; top:0; bottom:0; width:35%; border-radius:999px; background: rgba(255,255,255,0.22); animation: cplIndeterminate 1.2s ease-in-out infinite; }
.cpl-progress-text{ margin-top:8px; font-size:12px; color:var(--muted); }
@keyframes cplIndeterminate{ 0%{ transform: translateX(-60%);} 50%{ transform: translateX(120%);} 100%{ transform: translateX(260%);} }
.plot-wrap{position:relative;}
#plot{height:100vh; width:100%;}
.foot{margin-top:10px; font-size:11px; color:var(--muted);}

.traj-panel{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:10px; margin-top:8px;}
.traj-head{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;}
.traj-head .t{font-size:12px; color:var(--muted);}
.traj-list{display:flex; flex-direction:column; gap:6px; max-height:260px; overflow:auto; padding-right:4px;}
.traj-item{display:flex; gap:8px; align-items:center;}
.traj-item .name{font-size:12px; color:var(--text);}
.traj-item .meta{font-size:11px; color:var(--muted);}
.traj-sub{margin-left:22px; padding-left:10px; border-left:1px dashed var(--border);}
.small{font-size:11px; color:var(--muted);}
code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}



.btnbar-views{gap:8px;}
.btnbar-views .pill-select{flex:2; min-width:0;}
.btnbar-views button{flex:1; min-width:0;}

/* ---------- collapsible sections ---------- */
.section{position:relative;}
.section-head{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px; margin:0 0 10px;
  cursor:pointer; user-select:none;
}
.section-title{font-weight:700; font-size:13px;}
.section-toggle{
  width:26px; height:26px; padding:0; border-radius:10px;
  display:inline-flex; align-items:center; justify-content:center;
  background:var(--card); border:1px solid var(--border);
}
.section-toggle::before{
  content:"";
  width:8px; height:8px;
  border-right:2px solid var(--muted);
  border-bottom:2px solid var(--muted);
  transform: rotate(45deg);
  transition: transform .15s ease;
}
.section.collapsed .section-toggle::before{transform: rotate(-45deg);}
.section-body{display:block;}
.section.collapsed .section-body{display:none;}


.hovercard{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:10px; margin-top:10px;}
.hover-title{font-weight:700; font-size:12px;}
.hover-grid{display:grid; grid-template-columns: 1fr; gap:6px; margin-top:8px;}
.hrow{display:flex; justify-content:space-between; gap:10px;}
.hk{font-size:11px; color:var(--muted);}
.hv{font-size:12px; color:var(--text); text-align:right; word-break:break-all;}
.hover-note{margin-top:8px; font-size:11px; color:var(--muted); line-height:1.4;}


/* ---- Coupling summary ---- */
#cplSummary .cpl-kpis{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:8px; margin-top:8px;}
#cplSummary .cpl-item{background:var(--card); border:1px solid var(--border); border-radius:10px; padding:8px;}
#cplSummary .cpl-item .k{font-size:11px; color:var(--muted); line-height:1.2;}
#cplSummary .cpl-item .v{font-size:13px; font-weight:700; margin-top:2px;}
#cplSummary .cpl-table{width:100%; border-collapse:collapse; margin-top:10px;}
#cplSummary .cpl-table th, #cplSummary .cpl-table td{border-top:1px solid var(--border); padding:6px 4px; font-size:12px; vertical-align:top;}
#cplSummary .cpl-table th{color:var(--muted); font-weight:600; text-align:left;}
#cplSummary .cpl-table td small{color:var(--muted);}


/* --- Coupling parameter two-column collapsibles --- */
.cpl-cols{display:grid; grid-template-columns:1fr; gap:10px; margin-top:8px;}
.cpl-cols details.subsec{border:1px solid var(--border); border-radius:12px; background: rgba(255,255,255,0.02); padding:6px 8px;}
[data-theme="light"] .cpl-cols details.subsec{ background: rgba(0,0,0,0.02); }
.cpl-cols details.subsec summary{list-style:none; cursor:pointer; font-size:12px; color:var(--text); display:flex; align-items:center; justify-content:space-between; padding:4px 2px; user-select:none;}
.cpl-cols details.subsec summary::-webkit-details-marker{display:none;}
.cpl-cols details.subsec summary:after{content:"▾"; color:var(--muted); font-size:12px;}
.cpl-cols details.subsec:not([open]) summary:after{content:"▸";}
.cpl-cols .subsec-body{padding-top:6px;}
@media (max-width:820px){ .cpl-cols{grid-template-columns:1fr;} }

/* --- Hover HUD (follows cursor) --- */
.hover-hud{
  position:absolute;
  z-index:30;
  min-width:220px;
  max-width:340px;
  border:1px solid var(--border);
  border-radius:12px;
  padding:8px 10px;
  pointer-events:none;
  background: rgba(15,17,21,0.72);
  color: var(--text);
  backdrop-filter: blur(6px);
}
[data-theme="light"] .hover-hud{
  background: rgba(255,255,255,0.88);
}
.hover-hud.docked{ top:10px; right:10px; }
.hover-title{ font-size:12px; font-weight:650; margin-bottom:6px; }
.hover-grid{ display:grid; gap:4px; }
.hrow{ display:flex; justify-content:space-between; gap:10px; }
.hk{ color:var(--muted); font-size:11px; }
.hv{ color:var(--text); font-size:11px; font-variant-numeric: tabular-nums; }
